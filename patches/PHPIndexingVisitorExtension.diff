### Eclipse Workspace Patch 1.0
#P org.eclipse.php.core
Index: src/org/eclipse/php/core/index/PhpIndexingVisitorExtension.java
===================================================================
RCS file: /cvsroot/tools/org.eclipse.pdt/plugins/org.eclipse.php.core/src/org/eclipse/php/core/index/PhpIndexingVisitorExtension.java,v
retrieving revision 1.2
diff -u -r1.2 PhpIndexingVisitorExtension.java
--- src/org/eclipse/php/core/index/PhpIndexingVisitorExtension.java	27 Jun 2011 12:27:02 -0000	1.2
+++ src/org/eclipse/php/core/index/PhpIndexingVisitorExtension.java	29 Jun 2011 18:46:26 -0000
@@ -13,6 +13,7 @@
 
 import org.eclipse.dltk.ast.ASTNode;
 import org.eclipse.dltk.ast.ASTVisitor;
+import org.eclipse.dltk.core.ISourceModule;
 import org.eclipse.dltk.core.index2.IIndexingRequestor;
 import org.eclipse.dltk.core.index2.IIndexingRequestor.DeclarationInfo;
 import org.eclipse.dltk.core.index2.IIndexingRequestor.ReferenceInfo;
@@ -26,6 +27,7 @@
 public abstract class PhpIndexingVisitorExtension extends ASTVisitor {
 
 	protected IIndexingRequestor requestor;
+	protected ISourceModule sourceModule;
 
 	/**
 	 * This is a last chance before modifying element declaration information
@@ -55,4 +57,10 @@
 
 		this.requestor = requestor;
 	}
+
+	public void setSourceModule(ISourceModule module) {
+
+		this.sourceModule = module;
+
+	}
 }
Index: src/org/eclipse/php/internal/core/index/PhpIndexingParser.java
===================================================================
RCS file: /cvsroot/tools/org.eclipse.pdt/plugins/org.eclipse.php.core/src/org/eclipse/php/internal/core/index/PhpIndexingParser.java,v
retrieving revision 1.3
diff -u -r1.3 PhpIndexingParser.java
--- src/org/eclipse/php/internal/core/index/PhpIndexingParser.java	6 Oct 2009 11:38:57 -0000	1.3
+++ src/org/eclipse/php/internal/core/index/PhpIndexingParser.java	29 Jun 2011 18:46:26 -0000
@@ -27,7 +27,7 @@
 				.getModuleDeclaration(module);
 		if (moduleDeclaration != null) {
 			try {
-				moduleDeclaration.traverse(new PhpIndexingVisitor(requestor));
+				moduleDeclaration.traverse(new PhpIndexingVisitor(requestor, module));
 			} catch (Exception e) {
 				if (DLTKCore.DEBUG) {
 					e.printStackTrace();
Index: src/org/eclipse/php/internal/core/index/PhpIndexingVisitor.java
===================================================================
RCS file: /cvsroot/tools/org.eclipse.pdt/plugins/org.eclipse.php.core/src/org/eclipse/php/internal/core/index/PhpIndexingVisitor.java,v
retrieving revision 1.14
diff -u -r1.14 PhpIndexingVisitor.java
--- src/org/eclipse/php/internal/core/index/PhpIndexingVisitor.java	27 Jun 2011 12:27:02 -0000	1.14
+++ src/org/eclipse/php/internal/core/index/PhpIndexingVisitor.java	29 Jun 2011 18:46:27 -0000
@@ -32,6 +32,7 @@
 import org.eclipse.dltk.ast.references.VariableReference;
 import org.eclipse.dltk.ast.statements.Statement;
 import org.eclipse.dltk.core.IModelElement;
+import org.eclipse.dltk.core.ISourceModule;
 import org.eclipse.dltk.core.index2.IIndexingRequestor;
 import org.eclipse.dltk.core.index2.IIndexingRequestor.DeclarationInfo;
 import org.eclipse.dltk.core.index2.IIndexingRequestor.ReferenceInfo;
@@ -92,7 +93,7 @@
 
 	protected IIndexingRequestor requestor;
 
-	public PhpIndexingVisitor(IIndexingRequestor requestor) {
+	public PhpIndexingVisitor(IIndexingRequestor requestor, ISourceModule module) {
 		this.requestor = requestor;
 
 		List<PhpIndexingVisitorExtension> extensions = new ArrayList<PhpIndexingVisitorExtension>(
@@ -102,6 +103,9 @@
 				PhpIndexingVisitorExtension ext = (PhpIndexingVisitorExtension) element
 						.createExecutableExtension(CLASS_ATTR);
 				ext.setRequestor(requestor);
+				// pass the ISourceModule over to the extension
+				// in case it needs it during indexing
+				ext.setSourceModule(module);
 				extensions.add(ext);
 			} catch (CoreException e) {
 				Logger.logException(e);
